#!/usr/bin/env bash
set -e

SRC="$HOME/dotfiles/hypr/.config/hypr"
DST="$HOME/.config/hypr"
BACKUP="$HOME/.config/hypr_backup_$(date +%F-%H%M%S)"

if [ ! -d "$SRC" ]; then
  echo "[hypr-sync] ERROR: $SRC does not exist."
  exit 1
fi

echo "[hypr-sync] Backing up existing Hypr config (if any) to: $BACKUP"
if [ -d "$DST" ]; then
  mv "$DST" "$BACKUP"
fi

echo "[hypr-sync] Copying repo Hypr config to: $DST"
cp -r "$SRC" "$DST"

echo "[hypr-sync] Done."

# Try to reload Hyprland, but do not crash if it is not running
if command -v hyprctl >/dev/null 2>&1; then
  echo "[hypr-sync] Trying to reload Hyprland..."
  if hyprctl reload; then
    echo "[hypr-sync] Hyprland reloaded."
  else
    echo "[hypr-sync] hyprctl reload failed, maybe this is not a Hyprland session."
  fi
else
  echo "[hypr-sync] hyprctl not found, please reload Hyprland manually if needed."
fi
